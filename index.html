<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simple Sheet PRO</title> 
    <link rel="icon" type="image/png" href="favicon-96x96.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; margin: 0; }
        .calculator-container { max-width: 1200px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 15px rgba(0, 0, 0, 0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 20px; }
        
        .top-controls { display: flex; justify-content: space-between; align-items: stretch; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .master-name-group { flex: 1; display: flex; align-items: center; border: 1px solid #ced4da; border-radius: 5px; padding: 0 10px; background-color: #fff; min-width: 180px; max-width: 300px; height: 38px; }
        .master-name-group label { font-size: 0.85em; font-weight: bold; color: #666; margin-right: 8px; white-space: nowrap; }
        .master-name-input { flex-grow: 1; border: none; font-size: 0.9em; outline: none; width: 100%; height: 100%; }
        
        .lang-switch { display: flex; gap: 2px; flex-wrap: wrap; align-items: center; }
        .lang-button { background: #e9ecef; border: 1px solid #ced4da; padding: 5px 6px; cursor: pointer; border-radius: 4px; font-size: 0.75em; min-width: 35px; height: 38px; box-sizing: border-box; }
        .lang-button.active { background-color: #007bff; color: white; border-color: #007bff; }

        .utility-bar { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee; flex-wrap: wrap; }
        .util-btn { border: none; background: #6c757d; color: white; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9em; font-weight: bold; }

        .mode-toggle { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .mode-button { padding: 10px 20px; border: 1px solid #ddd; background: #fff; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .mode-button.active { background-color: #007bff; color: white; border-color: #007bff; }

        .master-row { padding: 20px; margin-bottom: 25px; border: 3px solid #dc3545; border-radius: 8px; background-color: #ffeaea; display: flex; align-items: center; box-sizing: border-box; }
        .master-label-text { font-weight: bold; margin-right: 15px; white-space: nowrap; }
        .master-input { flex-grow: 1; padding: 12px; border: 2px solid #333; border-radius: 5px; font-size: 1.6em; text-align: right; box-sizing: border-box; width: 100%; font-weight: bold; }

        .row { display: flex; align-items: center; margin-bottom: 12px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; flex-wrap: nowrap; }
        .text-label-input { flex: 2; padding: 12px; border: 1px solid #aaa; border-radius: 5px; margin-right: 10px; min-width: 100px; font-size: 1.1em; }
        
        .operator-group { display: flex; flex-direction: column; align-items: center; margin: 0 10px; min-width: 45px; }
        .op-arrow { font-size: 1.5em; cursor: pointer; color: #007bff; user-select: none; padding: 5px; }
        .operator-display { font-size: 2.0em; font-weight: bold; width: 40px; text-align: center; color: #333; line-height: 1; }
        
        .multiplier-input { width: 90px; padding: 12px; border: 2px solid #007bff; border-radius: 5px; text-align: right; font-size: 1.3em; font-weight: bold; }
        
        .btn-large { font-size: 1.5em; padding: 8px; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; background: #fff; display: flex; align-items: center; justify-content: center; min-width: 50px; min-height: 50px; margin: 0 5px; }
        .percent-toggle.active { background: #dc3545; color: #fff; border-color: #dc3545; }
        
        .result-group { display: flex; align-items: center; flex: 2; justify-content: flex-end; margin-left: 10px; border-left: 2px solid #ddd; padding-left: 15px; gap: 12px; }
        .result-text { font-size: 2.0em; font-weight: bold; color: #007bff; }
        .action-btn { background: none; border: 1px solid #eee; border-radius: 5px; cursor: pointer; font-size: 1.8em; padding: 8px; transition: background 0.2s; display: flex; align-items: center; justify-content: center; }

        @media screen and (max-width: 768px), screen and (orientation: portrait) {
            .master-row { display: block !important; padding: 15px !important; }
            .master-label-text { display: block !important; margin-bottom: 8px !important; }
            .row { flex-wrap: wrap; }
            .text-label-input { flex: 1 1 100%; margin-bottom: 10px; margin-right: 0; font-size: 1.2em; }
            .result-group { flex: 1 1 100%; border-left: none; padding-left: 0; margin-top: 15px; border-top: 2px solid #eee; padding-top: 12px; justify-content: space-between; }
            .result-text { font-size: 2.4em; }
        }

        #saveMessage { position: fixed; bottom: 20px; right: 20px; background: #333; color: #fff; padding: 10px 20px; border-radius: 5px; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 1000; }
    </style>
</head>
<body onload="init()">
    <div class="calculator-container">
        <div class="top-controls">
            <div class="master-name-group">
                 <label id="lbl-name">Name:</label>
                 <input type="text" id="masterLabel" class="master-name-input" oninput="saveSettings()">
            </div>
            <div class="lang-switch">
                <button class="lang-button" id="lang-en" onclick="setLanguage('en')">EN</button>
                <button class="lang-button" id="lang-ja" onclick="setLanguage('ja')">JP</button>
                <button class="lang-button" id="lang-zh" onclick="setLanguage('zh')">CN</button>
                <button class="lang-button" id="lang-ko" onclick="setLanguage('ko')">KR</button>
                <button class="lang-button" id="lang-es" onclick="setLanguage('es')">ES</button>
                <button class="lang-button" id="lang-fr" onclick="setLanguage('fr')">FR</button>
                <button class="lang-button" id="lang-pt" onclick="setLanguage('pt')">PT</button>
            </div>
        </div>

        <h2 id="title">Simple Sheet PRO</h2>

        <div class="utility-bar">
            <button class="util-btn" onclick="clearNumbers()">üßπ <span id="btn-clear">Clear</span></button>
            <button class="util-btn" onclick="exportData()">üì§ <span id="btn-export">Export</span></button>
            <button class="util-btn" onclick="importData()">üì• <span id="btn-import">Import</span></button>
            <button class="util-btn" style="background:#dc3545;" onclick="fullReset()">üîÑ <span id="btn-reset">Reset</span></button>
        </div>

        <div class="mode-toggle">
            <button id="smartSheetBtn" class="mode-button" onclick="switchMode('smartSheet')">Simple</button>
            <button id="customSimpleBtn" class="mode-button" onclick="switchMode('customSimple')">Custom</button>
        </div>

        <div id="smart-sheet-mode">
            <div class="master-row">
                <label id="lbl-base" class="master-label-text">Base Value</label>
                <input type="number" id="masterInput" class="master-input" value="1000" oninput="updateDisplay()">
            </div>
            <div id="rows-container-smart"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="mode-button" style="background:#28a745; color:#fff; padding:15px 30px; font-size:1.1em;" onclick="addRowSmart()">+ Add Row</button>
                <button class="mode-button" style="background:#007bff; color:#fff; padding:15px 30px; font-size:1.1em;" onclick="copyPage('smart')">Copy All</button>
            </div>
        </div>

        <div id="custom-simple-mode" style="display: none;">
            <div class="master-row">
                <label id="lbl-base-c" class="master-label-text">Base Value</label>
                <input type="number" id="masterInputSimple" class="master-input" value="1000" oninput="updateDisplay()">
            </div>
            <div id="rows-container-simple"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="mode-button" style="background:#28a745; color:#fff; padding:15px 30px; font-size:1.1em;" onclick="addRowSimple()">+ Add Row</button>
                <button class="mode-button" style="background:#007bff; color:#fff; padding:15px 30px; font-size:1.1em;" onclick="copyPage('custom')">Copy All</button>
            </div>
        </div>
        <div id="saveMessage">Saved</div>
    </div>

    <script>
        const translations = {
            en: { title: 'Simple Sheet PRO', name: 'Name:', base: 'Base Value', clear: 'Clear', export: 'Export', import: 'Import', reset: 'Reset', copy: 'Copied' },
            ja: { title: '„Ç∑„É≥„Éó„É´„Ç∑„Éº„Éà PRO', name: 'Ë®àÁÆóÂêç:', base: 'ÂÖÉ„ÅÆÊï∞Â≠ó', clear: '„ÇØ„É™„Ç¢', export: 'Âá∫Âäõ', import: 'Ë™≠Ëæº', reset: 'ÂàùÊúüÂåñ', copy: '„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü' },
            zh: { title: 'ÁÆÄÂçïËÆ°ÁÆó PRO', name: 'ÂêçÁß∞:', base: 'Âü∫Á°ÄÊï∞ÂÄº', clear: 'Ê∏ÖÈô§', export: 'ÂØºÂá∫', import: 'ÂØºÂÖ•', reset: 'ÈáçÁΩÆ', copy: 'Â∑≤Â§çÂà∂' },
            ko: { title: 'Ïã¨Ìîå ÏãúÌä∏ PRO', name: 'Ïù¥Î¶Ñ:', base: 'Í∏∞Ï§Ä Ïà´Ïûê', clear: 'ÏÇ≠Ï†ú', export: 'ÎÇ¥Î≥¥ÎÇ¥Í∏∞', import: 'Í∞ÄÏ†∏Ïò§Í∏∞', reset: 'Ï¥àÍ∏∞Ìôî', copy: 'Î≥µÏÇ¨Îê®' },
            es: { title: 'Hoja Simple PRO', name: 'Nombre:', base: 'Valor Base', clear: 'Limpiar', export: 'Exportar', import: 'Importar', reset: 'Reiniciar', copy: 'Copiado' },
            fr: { title: 'Feuille Simple PRO', name: 'Nom:', base: 'Valeur de Base', clear: 'Effacer', export: 'Exporter', import: 'Importer', reset: 'R√©initialiser', copy: 'Copi√©' },
            pt: { title: 'Folha Simples PRO', name: 'Nome:', base: 'Valor Base', clear: 'Limpar', export: 'Exportar', import: 'Importar', reset: 'Redefinir', copy: 'Copiado' }
        };

        let currentLang = 'en';

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('userLang', lang);
            const t = translations[lang];
            document.querySelectorAll('.lang-button').forEach(b => b.classList.toggle('active', b.id === 'lang-'+lang));
            document.getElementById('title').textContent = t.title;
            document.getElementById('lbl-name').textContent = t.name;
            document.getElementById('lbl-base').textContent = t.base;
            document.getElementById('lbl-base-c').textContent = t.base;
            document.getElementById('btn-clear').textContent = t.clear;
            document.getElementById('btn-export').textContent = t.export;
            document.getElementById('btn-import').textContent = t.import;
            document.getElementById('btn-reset').textContent = t.reset;
            updateDisplay();
        }

        function updateDisplay() {
            const mv = parseFloat(document.getElementById('masterInput').value)||0;
            document.querySelectorAll('#rows-container-smart .row').forEach(r => {
                const id=r.dataset.id, op=document.getElementById('smart-op-'+id).textContent, mult=parseFloat(r.querySelector('.multiplier-input').value)||0, pct=r.querySelector('.percent-toggle').classList.contains('active');
                let res=0, mod=pct?mv*(mult/100):mult;
                if(op==='+') res=mv+mod; else if(op==='-') res=mv-mod; else if(op==='√ó') res=pct?mv*(mult/100):mv*mult; else if(op==='√∑') res=mult!==0?mv/mult:0;
                document.getElementById('smart-res-'+id).textContent = Math.round(res).toLocaleString();
            });
            let chain = parseFloat(document.getElementById('masterInputSimple').value)||0;
            document.querySelectorAll('#rows-container-simple .row').forEach(r => {
                const id=r.dataset.id, op=document.getElementById('simple-op-'+id).textContent, mult=parseFloat(r.querySelector('.multiplier-input').value)||0, pct=r.querySelector('.percent-toggle').classList.contains('active');
                const isChain = document.getElementById('simple-base-'+id).classList.contains('chain');
                const base = isChain ? chain : parseFloat(document.getElementById('masterInputSimple').value)||0;
                let mod=pct?base*(mult/100):mult, res=0;
                if(op==='+') res=base+mod; else if(op==='-') res=base-mod; else if(op==='√ó') res=pct?base*(mult/100):base*mult; else if(op==='√∑') res=mult!==0?base/mult:0;
                document.getElementById('simple-run-'+id).textContent = Math.round(res).toLocaleString(); chain=res;
            });
            saveSettings();
        }

        function addRowSmart(s=null) {
            const id = Date.now() + Math.random().toString(36).substr(2, 5);
            const div = document.createElement('div'); div.className='row'; div.dataset.id=id;
            div.innerHTML = `<input type="text" class="text-label-input" value="${s?s.label:''}" oninput="saveSettings()">
                <div class="operator-group"><div class="op-arrow" onclick="changeOp('${id}','smart',1)">‚ñ≤</div><div class="operator-display" id="smart-op-${id}">${s?s.operator:'+'}</div><div class="op-arrow" onclick="changeOp('${id}','smart',-1)">‚ñº</div></div>
                <input type="number" class="multiplier-input" value="${s?s.multiplier:'0'}" oninput="updateDisplay()">
                <div class="btn-large percent-toggle ${s&&s.isPercentActive?'active':''}" onclick="this.classList.toggle('active');updateDisplay()">%</div>
                <div class="result-group"><div class="result-text" id="smart-res-${id}">0</div><button class="action-btn" onclick="copyText('smart-res-${id}')">üìã</button><button class="action-btn" onclick="this.closest('.row').remove();updateDisplay()">üóëÔ∏è</button></div>`;
            document.getElementById('rows-container-smart').appendChild(div); updateDisplay();
        }

        function addRowSimple(s=null) {
            const id = Date.now() + Math.random().toString(36).substr(2, 5);
            const div = document.createElement('div'); div.className='row'; div.dataset.id=id;
            const isChain = s ? s.baseMode==='chain' : true;
            div.innerHTML = `<input type="text" class="text-label-input" value="${s?s.label:''}" oninput="saveSettings()">
                <div id="simple-base-${id}" class="btn-large ${isChain?'chain':''}" style="border-radius:50%;" onclick="this.classList.toggle('chain');this.textContent=this.classList.contains('chain')?'üîó':'üè†';updateDisplay()">${isChain?'üîó':'üè†'}</div>
                <div class="operator-group"><div class="op-arrow" onclick="changeOp('${id}','simple',1)">‚ñ≤</div><div class="operator-display" id="simple-op-${id}">${s?s.operator:'+'}</div><div class="op-arrow" onclick="changeOp('${id}','simple',-1)">‚ñº</div></div>
                <input type="number" class="multiplier-input" value="${s?s.multiplier:'0'}" oninput="updateDisplay()">
                <div class="btn-large percent-toggle ${s&&s.isPercentActive?'active':''}" onclick="this.classList.toggle('active');updateDisplay()">%</div>
                <div class="result-group"><div class="result-text" id="simple-run-${id}">0</div><button class="action-btn" onclick="copyText('simple-run-${id}')">üìã</button><button class="action-btn" onclick="this.closest('.row').remove();updateDisplay()">üóëÔ∏è</button></div>`;
            document.getElementById('rows-container-simple').appendChild(div); updateDisplay();
        }

        function changeOp(id,m,d){ const ops=['+','-','√ó','√∑']; const el=document.getElementById(m+'-op-'+id); el.textContent=ops[(ops.indexOf(el.textContent)+d+4)%4]; updateDisplay(); }
        function switchMode(m){ document.getElementById('smart-sheet-mode').style.display=m==='smartSheet'?'block':'none'; document.getElementById('custom-simple-mode').style.display=m==='customSimple'?'block':'none'; document.getElementById('smartSheetBtn').classList.toggle('active',m==='smartSheet'); document.getElementById('customSimpleBtn').classList.toggle('active',m==='customSimple'); localStorage.setItem('mode',m); }
        function copyText(id){ navigator.clipboard.writeText(document.getElementById(id).textContent); showMsg(translations[currentLang].copy); }
        function copyPage(m){ 
            let t = `„Äê${document.getElementById('masterLabel').value || 'Sheet'}„Äë\n`;
            const container = m==='smart' ? '#rows-container-smart' : '#rows-container-simple';
            document.querySelectorAll(container+' .row').forEach(r => {
                const label = r.querySelector('.text-label-input').value || '-';
                const res = r.querySelector('.result-text').textContent;
                t += `${label}: ${res}\n`;
            });
            navigator.clipboard.writeText(t); showMsg(translations[currentLang].copy);
        }

        function saveSettings(){
            const s = {
                name: document.getElementById('masterLabel').value, mv: document.getElementById('masterInput').value, mvc: document.getElementById('masterInputSimple').value,
                smart: Array.from(document.querySelectorAll('#rows-container-smart .row')).map(r=>({label:r.querySelector('.text-label-input').value, multiplier:r.querySelector('.multiplier-input').value, operator:document.getElementById('smart-op-'+r.dataset.id).textContent, isPercentActive:r.querySelector('.percent-toggle').classList.contains('active')})),
                simple: Array.from(document.querySelectorAll('#rows-container-simple .row')).map(r=>({label:r.querySelector('.text-label-input').value, multiplier:r.querySelector('.multiplier-input').value, operator:document.getElementById('simple-op-'+r.dataset.id).textContent, isPercentActive:r.querySelector('.percent-toggle').classList.contains('active'), baseMode:document.getElementById('simple-base-'+r.dataset.id).classList.contains('chain')?'chain':'master'}))
            };
            localStorage.setItem('settings', JSON.stringify(s));
        }

        function init(){
            const s = JSON.parse(localStorage.getItem('settings')||'{}');
            document.getElementById('masterLabel').value = s.name||'';
            document.getElementById('masterInput').value = s.mv||1000;
            document.getElementById('masterInputSimple').value = s.mvc||1000;
            if(s.smart && s.smart.length) s.smart.forEach(r=>addRowSmart(r)); else addRowSmart();
            if(s.simple && s.simple.length) s.simple.forEach(r=>addRowSimple(r)); else addRowSimple();
            setLanguage(localStorage.getItem('userLang')||'en');
            switchMode(localStorage.getItem('mode')||'smartSheet');
        }

        function clearNumbers(){ document.getElementById('masterInput').value=0; document.getElementById('masterInputSimple').value=0; document.querySelectorAll('.multiplier-input').forEach(i=>i.value=0); updateDisplay(); }
        function fullReset(){ if(confirm('Reset?')){ localStorage.clear(); location.reload(); } }
        function exportData(){ navigator.clipboard.writeText(btoa(JSON.stringify(localStorage))); showMsg("Exported"); }
        function importData(){ const p=prompt("Data:"); if(p){ try{const d=JSON.parse(atob(p)); Object.keys(d).forEach(k=>localStorage.setItem(k,d[k])); location.reload();}catch(e){alert("Error");} } }
        function showMsg(t){ const m=document.getElementById('saveMessage'); m.textContent=t; m.style.opacity=1; setTimeout(()=>m.style.opacity=0,2000); }
    </script>
</body>
</html>
